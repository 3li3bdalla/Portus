<!DOCTYPE html>
<html>
  <head>
    <title>Removing images and tags</title>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="  Only available in 2.1 or later.">

    <link href="/stylesheets/portus.css"  type="text/css" rel="stylesheet" />
    <script src="/javascripts/dist/portus.min.js" type="text/javascript" charset="utf-8"></script>

    <meta name="viewport" content="width=device-width, initial-scale=1">

<!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!--[if lt IE 9]>
  <script src="//oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
  <script src="//oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->

<!-- Favicon for all different devices -->
<meta content="width=device-width, initial-scale=1" name="viewport" />
<link href="/images/favicon/apple-touch-icon-57x57.png" rel="apple-touch-icon" sizes="57x57" />
<link href="/images/favicon/apple-touch-icon-60x60.png" rel="apple-touch-icon" sizes="60x60" />
<link href="/images/favicon/apple-touch-icon-72x72.png" rel="apple-touch-icon" sizes="72x72" />
<link href="/images/favicon/apple-touch-icon-76x76.png" rel="apple-touch-icon" sizes="76x76" />
<link href="/images/favicon/apple-touch-icon-114x114.png" rel="apple-touch-icon" sizes="114x114" />
<link href="/images/favicon/apple-touch-icon-120x120.png" rel="apple-touch-icon" sizes="120x120" />
<link href="/images/favicon/apple-touch-icon-144x144.png" rel="apple-touch-icon" sizes="144x144" />
<link href="/images/favicon/apple-touch-icon-152x152.png" rel="apple-touch-icon" sizes="152x152" />
<link href="/images/favicon/apple-touch-icon-180x180.png" rel="apple-touch-icon" sizes="180x180" />
<link href="/images/favicon/favicon-32x32.png" rel="icon" sizes="32x32" type="image/png" />
<link href="/images/favicon/android-chrome-192x192.png" rel="icon" sizes="192x192" type="image/png" />
<link href="/images/favicon/favicon-96x96.png" rel="icon" sizes="96x96" type="image/png" />
<link href="/images/favicon/favicon-16x16.png" rel="icon" sizes="16x16" type="image/png" />
<link href="/images/favicon/manifest.json" rel="manifest" />
<link color="#205683" href="/images/favicon/safari-pinned-tab.svg" rel="mask-icon" />
<link href="/images/favicon/favicon.ico" rel="shortcut icon" />
<meta content="Portus" name="apple-mobile-web-app-title" />
<meta content="Portus" name="application-name" />
<meta content="#da532c" name="msapplication-TileColor" />
<meta content="/images/favicon/mstile-144x144.png" name="msapplication-TileImage" />
<meta content="/images/favicon/browserconfig.xml" name="msapplication-config" />
<meta content="#205683" name="theme-color" />

  </head>
  <body>
    <header id="portus-header" class="portus-topbar">
  <div class="container-fluid">
    <i id="open_main_menu" class="fa fa-bars fa-2x visible-xs menu-sandwich"></i>

    <a href="/">
      <img class="pull-left img-responsive topbar-logo" src="/images/logo-header.png" alt="Logo on header">
    </a>
    <div class="pull-right hidden-xs">
      <a class="btn btn-link" href="/blog/index.html">Blog</a>
      <a class="btn btn-link" href="/features.html">Features</a>
      <a class="btn btn-link" href="/documentation.html">Documentation</a>
    </div>
    <div class="clearfix"></div>
  </div>
</header>

<div id="mobile-menu" class="visible-xs mobile-menu">
  <ul>
    <li><i class="fa fa-list-ul"></i><a class="btn btn-link" href="/features.html">Features</a></li>
    <li><i class="fa fa-book"></i><a class="btn btn-link" href="/documentation.html">Documentation</a></li>
    <li><i class="fa fa-newspaper-o"></i><a class="btn btn-link" href="/blog/index.html">Blog</a></li>
    <li><i class="fa fa-question-circle"></i><a class="btn btn-link" href="/docs/FAQ.html">FAQ</a></li>
  </ul>
</div>

    <div class="container" id="documentation">
      <div class="row">
        <div class="post-content col-md-10 col-md-offset-3 col-sm-12 col-xs-12">
          <section>
            <div class="row">
              <div class="visible-xs visible-sm">
  <div class="content-bar">
    <ul class="topics">
      <li class="dropdown">
        <button class="dropdown-toggle" type="button" data-toggle="dropdown">Documentation Index
        <span class="caret"></span></button>
        <ul class="dropdown-menu">
          <li class="dropdown-header">Documentation</li>
          
          
            <li>
              <a href="/docs/first-steps.html">
                Docker and Portus for newcomers
              </a>
            </li>
          
            <li>
              <a href="/docs/Configuring-Portus.html">
                Configuring Portus
              </a>
            </li>
          
            <li>
              <a href="/docs/database.html">
                Configuring the database
              </a>
            </li>
          
            <li>
              <a href="/docs/How-to-setup-secure-registry.html">
                Configuring a secure private registry
              </a>
            </li>
          
            <li>
              <a href="/docs/deploy.html">
                Deploying Portus
              </a>
            </li>
          
            <li>
              <a href="/docs/Configuring-the-registry.html">
                Portus and your private registry
              </a>
            </li>
          
            <li>
              <a href="/docs/assets.html">
                Managing assets
              </a>
            </li>
          
            <li>
              <a href="/docs/secrets.html">
                Using secrets
              </a>
            </li>
          
            <li>
              <a href="/docs/API.html">
                Portus REST API
              </a>
            </li>
          
            <li>
              <a href="/docs/background.html">
                The background process
              </a>
            </li>
          
            <li>
              <a href="/docs/portusctl.html">
                portusctl
              </a>
            </li>
          
            <li>
              <a href="/docs/upgrading-portus.html">
                Upgrading Portus
              </a>
            </li>
          
            <li>
              <a href="/docs/versions.html">
                Supported Docker Versions
              </a>
            </li>
          
            <li>
              <a href="/docs/debugging.html">
                Debugging Portus
              </a>
            </li>
          
            <li>
              <a href="/docs/how_we_release.html">
                Portus Releases
              </a>
            </li>
          
            <li>
              <a href="/docs/release-schedule.html">
                Release schedule
              </a>
            </li>
          
            <li>
              <a href="/docs/FAQ.html">
                FAQ
              </a>
            </li>
          
          <li class="dropdown-header">Features</li>
          
          
            <li>
              <a href="/features/1_Synchronizing-the-Registry-and-Portus.html">
                Synchonizing the Registry and Portus
              </a>
            </li>
          
            <li>
              <a href="/features/2_LDAP-support.html">
                LDAP support
              </a>
            </li>
          
            <li>
              <a href="/features/3_teams_namespaces_and_users.html">
                Teams, namespaces and users
              </a>
            </li>
          
            <li>
              <a href="/features/4_audit.html">
                Audit
              </a>
            </li>
          
            <li>
              <a href="/features/5_search.html">
                Search
              </a>
            </li>
          
            <li>
              <a href="/features/6_security_scanning.html">
                Security scanning
              </a>
            </li>
          
            <li>
              <a href="/features/removing_images.html">
                Removing images and tags
              </a>
            </li>
          
            <li>
              <a href="/features/6_starring.html">
                Starring repositories
              </a>
            </li>
          
            <li>
              <a href="/features/7_disabling_users.html">
                Removing/Disabling users
              </a>
            </li>
          
            <li>
              <a href="/features/anonymous_browsing.html">
                Anonymous browsing
              </a>
            </li>
          
            <li>
              <a href="/features/8_locking.html">
                Locking accounts for safety reasons
              </a>
            </li>
          
            <li>
              <a href="/features/9_recovering_password.html">
                Recovering the password
              </a>
            </li>
          
            <li>
              <a href="/features/disabling_signup.html">
                Disabling the sign up form
              </a>
            </li>
          
            <li>
              <a href="/features/oauth.html">
                OAuth and OpenID Connect support
              </a>
            </li>
          
            <li>
              <a href="/features/application_tokens.html">
                Application tokens
              </a>
            </li>
          
            <li>
              <a href="/features/display_name.html">
                Display name
              </a>
            </li>
          
            <li>
              <a href="/features/health.html">
                Health checking
              </a>
            </li>
          
        </ul>
      </li>
    </ul>
  </div>
</div>

            </div>
            <div class="row post">
              <article>
                <div class="alert alert-info">
  Only available in <strong>2.1 or later</strong>.
</div>

<h2 id="intro">Intro</h2>

<p>One of the most remarkable features from the 2.1 release is the ability to
remove images and tags. This has not been possible until now because, even
though it has always been possible to delete an image by manifest (<em>soft
delete</em>), the orphaned blobs couldn’t be properly removed. Therefore, we
decided that it was better to not provide this feature at all because otherwise
we would be lying to our users (by saying that an image was deleted when in
fact it wasn’t really).</p>

<p>Fortunately, Docker Distribution 2.4 implemented a Garbage Collector, which
basically removes all the blobs that have been orphaned (no manifest is
referencing them). We have two challenges though:</p>

<ol>
  <li>Maintenance has to be done manually (see <a href="#maintenance">Maintenance</a>).</li>
  <li>Portus has no way to check the version of the running registry, so the
administrator has to
<a href="/docs/Configuring-Portus.html#delete-support">explicitly enable this</a>.</li>
</ol>

<p>Note that this feature has to be enabled from the registry’s side too. This can
be enabled by setting the
<a href="https://github.com/docker/distribution/blob/master/docs/configuration.md#delete">storage/delete</a>
option to true.</p>

<h2 id="removing-images--tags">Removing images &amp; tags</h2>

<p>Removing images and tags is quite intuitive from a user point of view. Just go
to the repository page:</p>

<p><img src="/images/docs/repo-images.png" alt="Repository page" /></p>

<p>In there, you can see trash cans. Click on any of them and a confirmation form
will pop up. If you agree, then you will have removed the specified tag or
image. Moreover, all this is still tracked in the activities list. For
example, let’s say that in the previous example we removed the <code class="highlighter-rouge">latest</code> tag.
Then we would have the following activities list:</p>

<p><img src="/images/docs/repo-activities1.png" alt="Activities of removing a tag" /></p>

<p>Now, in the same repository page, if we want to remove the image and all its
tags, we can just simply click on the “Delete image” link located on the top
right corner of the page. In the previous example, if now we removed the whole
image, we would get the following activities list:</p>

<p><img src="/images/docs/repo-activities2.png" alt="Activities of removing an image" /></p>

<h2 id="maintenance">Maintenance</h2>

<p>The Garbage Collector (GC from now on) is a crucial part on this feature and
it’s implemented by Docker Distribution. The bad thing is that it has been
provided as a separate command. This means that administrators have to call
this command explicitly instead of it being handled automatically for us.
Moreover, in order to do it safely in production, some downtime is to be
expected: you can run the GC anytime you want but it will bring concurrency
issues if executed when some pushes were being performed. You have two ways to
avoid concurrency problems:</p>

<ol>
  <li>If you are expecting the GC to be fast, then stopping the registry, running
the GC and restarting the registry again should do the trick.</li>
  <li>If you expect the GC to take a fair amount of time, then we recommend to
restart your registry in <a href="https://github.com/docker/distribution/blob/master/docs/configuration.md#read-only-mode">read-only
mode</a>
and perform GC then. Once GC is over, you can restart your registry again
with read-only mode disabled.</li>
</ol>

<p>As you can see, there is no way around this: you have to expect some downtime
if you want to do some cleanup in your registry. One reasonable question for
this situation is: how do I know whether the GC process is going to take a
long time or not? There is no hard rule for it but our experience tells us
that you will have to proceed with the second point above if you have quite
some images stored in a cloud storage service like Amazon’s S3. That is, the
main bottleneck is accessing your storage service, othewise GC should be fast.</p>

<p>Despite this inconvenience in maintenance, running the GC is actually quite
simple. You just have to call the registry command with the new
<code class="highlighter-rouge">garbage-collect</code> command. It accepts one argument: the configuration file.
Moreover, if you just want to check whether there are orphaned blobs or not,
you can simulate the garbage collection by using the dry-run mode with the
<code class="highlighter-rouge">-d</code> flag.</p>

              </article>
            </div>
          </section>
        </div>
      </div>
      <aside class="hidden-xs hidden-sm content-list">
  <ul class="topics">
    <li>Documentation</li>
    <ul class="subtopics">
      
      
        <li>
          <a href="/docs/first-steps.html">
            Docker and Portus for newcomers
          </a>
        </li>
      
        <li>
          <a href="/docs/Configuring-Portus.html">
            Configuring Portus
          </a>
        </li>
      
        <li>
          <a href="/docs/database.html">
            Configuring the database
          </a>
        </li>
      
        <li>
          <a href="/docs/How-to-setup-secure-registry.html">
            Configuring a secure private registry
          </a>
        </li>
      
        <li>
          <a href="/docs/deploy.html">
            Deploying Portus
          </a>
        </li>
      
        <li>
          <a href="/docs/Configuring-the-registry.html">
            Portus and your private registry
          </a>
        </li>
      
        <li>
          <a href="/docs/assets.html">
            Managing assets
          </a>
        </li>
      
        <li>
          <a href="/docs/secrets.html">
            Using secrets
          </a>
        </li>
      
        <li>
          <a href="/docs/API.html">
            Portus REST API
          </a>
        </li>
      
        <li>
          <a href="/docs/background.html">
            The background process
          </a>
        </li>
      
        <li>
          <a href="/docs/portusctl.html">
            portusctl
          </a>
        </li>
      
        <li>
          <a href="/docs/upgrading-portus.html">
            Upgrading Portus
          </a>
        </li>
      
        <li>
          <a href="/docs/versions.html">
            Supported Docker Versions
          </a>
        </li>
      
        <li>
          <a href="/docs/debugging.html">
            Debugging Portus
          </a>
        </li>
      
        <li>
          <a href="/docs/how_we_release.html">
            Portus Releases
          </a>
        </li>
      
        <li>
          <a href="/docs/release-schedule.html">
            Release schedule
          </a>
        </li>
      
        <li>
          <a href="/docs/FAQ.html">
            FAQ
          </a>
        </li>
      
    </ul>
    <li>Features</li>
    <ul class="subtopics">
      
      
        <li>
          <a href="/features/1_Synchronizing-the-Registry-and-Portus.html">
            Synchonizing the Registry and Portus
          </a>
        </li>
      
        <li>
          <a href="/features/2_LDAP-support.html">
            LDAP support
          </a>
        </li>
      
        <li>
          <a href="/features/3_teams_namespaces_and_users.html">
            Teams, namespaces and users
          </a>
        </li>
      
        <li>
          <a href="/features/4_audit.html">
            Audit
          </a>
        </li>
      
        <li>
          <a href="/features/5_search.html">
            Search
          </a>
        </li>
      
        <li>
          <a href="/features/6_security_scanning.html">
            Security scanning
          </a>
        </li>
      
        <li>
          <a href="/features/removing_images.html">
            Removing images and tags
          </a>
        </li>
      
        <li>
          <a href="/features/6_starring.html">
            Starring repositories
          </a>
        </li>
      
        <li>
          <a href="/features/7_disabling_users.html">
            Removing/Disabling users
          </a>
        </li>
      
        <li>
          <a href="/features/anonymous_browsing.html">
            Anonymous browsing
          </a>
        </li>
      
        <li>
          <a href="/features/8_locking.html">
            Locking accounts for safety reasons
          </a>
        </li>
      
        <li>
          <a href="/features/9_recovering_password.html">
            Recovering the password
          </a>
        </li>
      
        <li>
          <a href="/features/disabling_signup.html">
            Disabling the sign up form
          </a>
        </li>
      
        <li>
          <a href="/features/oauth.html">
            OAuth and OpenID Connect support
          </a>
        </li>
      
        <li>
          <a href="/features/application_tokens.html">
            Application tokens
          </a>
        </li>
      
        <li>
          <a href="/features/display_name.html">
            Display name
          </a>
        </li>
      
        <li>
          <a href="/features/health.html">
            Health checking
          </a>
        </li>
      
    </ul>
  </ul>
  <div class="credits">
    <div class="text-center" lang="en">Created with <i class='fa fa-heart secondary-colour'></i> by the SUSE team</div>
  </div>
</aside>

      <div class="visible-xs visible-sm credits">
        <div class="text-center" lang="en">Created with <i class='fa fa-heart secondary-colour'></i> by the SUSE team</div>
      </div>
    </div>
  </body>
</html>
